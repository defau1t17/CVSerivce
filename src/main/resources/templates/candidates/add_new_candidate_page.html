<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add New</title>
    <link rel="stylesheet" th:src="@{/candidates/add_new_candidate_style.css}">

</head>
<body>
<!--<div class="container">-->
<!--    <div class="input-data-container">-->
<!--        <input type="text" id="input-name-field" placeholder="Input candidate name">-->
<!--        <input type="text" id="input-second-name-field" placeholder="Input candidate second name">-->
<!--        <input type="text" id="input-patronymic-field" placeholder="Input candidate patronymic">-->
<!--        <input type="hidden" id="_csrf_token" name="_csrf" th:content="${_csrf.token}">-->

<!--        <div class="select-directions-container">-->
<!--            <input class="select-direction" id="" type="checkbox" th:each="direction : ${directions}"-->
<!--                   th:text="${direction.name}"-->
<!--                   th:value="${direction.id + ',' + direction.name + ',' + direction.description}">-->
<!--        </div>-->


<!--        <div class="input-file-container">-->
<!--            <input type="file" id="input-cv-file">-->
<!--            <input type="file" id="input-image-file">-->
<!--        </div>-->


<!--    </div>-->

<!--    <div class="button-container">-->
<!--        <button onclick="addNewCandidateRequest()" type="submit">ADD</button>-->
<!--        <button type="reset">CLEAR</button>-->
<!--    </div>-->

<!--</div>-->

<div>
    <form method="post" action="#" th:action="@{/task/candidates/add}" th:object="${newCandidate}"
          enctype="multipart/form-data" id="newCandidateForm">
        <input th:field="*{name}" type="text" id="input-name-field" placeholder="Input candidate name">
        <input th:field="*{second_name}" type="text" id="input-second-name-field"
               placeholder="Input candidate second name" required>
        <input th:field="*{patr}" type="text" id="input-patronymic-field" placeholder="Input candidate patronymic">
        <input type="hidden" id="_csrf_token" name="_csrf" th:content="${_csrf.token}" required>


        <div class="select-directions-container">
            <input th:each="direction : ${allDirections}" th:field="*{directions}" th:value="${direction.id}"
                   id="direction" type="checkbox">
        </div>
        <div class="input-file-container">
            <input th:field="*{cvFile}" name="cvFile" type="file" id="input-cv-file">
            <input th:field="*{imageFile}" name="imageFile" type="file" id="input-image-file">
        </div>

        <button type="button" onclick="addNewCandidateRequest()">ADD</button>
    </form>
</div>

<div id="notification" class="notification">

</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var csrf_token = $('#_csrf_token').attr("content");


    function addNewCandidateRequest() {

        var formData = new FormData($('#newCandidateForm')[0]);

        var candidateData = {};
        formData.forEach(function (value, key) {
            candidateData[key] = value;
        });

        $.ajax({
            url: '/task/candidates/rest/add/new',
            type: 'POST',
            processData: false,
            contentType: false,
            data: formData,
            beforeSend: function (xhr) {
                xhr.setRequestHeader('X-CSRF-TOKEN', csrf_token);
            },
            success: function (data, status, xhr) {
                if (xhr.status === 200) {
                    location.reload();
                    // showNotification("Пользователь успешно добавлен", 1000);
                    console.log('Изображения успешно загружены.');
                } else if (xhr.status === 404) {
                    console.error('Произошла ошибка при загрузке изображений.');
                }
            }
        });
    }


    const notification = document.getElementById('notification');

    function showNotification(message, duration) {
        notification.textContent = message;
        notification.style.opacity = '1';

        setTimeout(() => {
            notification.style.opacity = '0';
        }, duration);
    }


</script>
</body>
</html>